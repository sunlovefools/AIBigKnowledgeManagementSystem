# Frontend Workspace (MainPage)

[Feature index](./README.md) | [Authentication](./authentication.md) | [Ingestion pipeline](./ingestion-pipeline.md) | [Query & RAG](./query-pipeline.md) | [Frontend register](./frontend-register.md) | [Frontend workspace](./frontend-workspace.md)

Feature covering the chat-style workspace where users ask questions, upload documents, and view AI responses.

## Purpose
- Provide a conversational UI tied to the RAG backend and ingestion endpoint.
- Allow quick backend connectivity tests during development.

## Key code
- Component: `frontend/src/pages/mainpage/MainPage.tsx`
- Styles: `frontend/src/pages/mainpage/MainPage.css`
- Routing shell: `frontend/src/App.tsx` defines `/mainpage`.

## Behavior
1) State tracked via hooks: `messages`, `input`, `selectedFile`, `fileContent`, `response`, plus refs for scroll/file input.
2) `handleSend()` workflow:
   - Pushes the user message into chat state.
   - Calls `POST {API_BASE}/api/query` with `{ query }`; appends AI reply or error fallback.
   - If a file is selected, posts to `POST {API_BASE}/ingest/webhook` with `{ fileName, contentType, data }` (base64 payload generated by `FileReader`).
   - Clears the input and selected file.
3) `handleBackendTestClick()` calls `GET {API_BASE}/hello` to confirm connectivity and stores the message in `response`.
4) `handleLogout()` clears `localStorage.token` and routes to `/register`.
5) UI touches: auto-scroll to newest message, file chip display with remove button, Markdown rendering for AI responses via `react-markdown` + `remark-gfm` + `rehype-highlight`.

## Configuration
- Same `VITE_API_BASE` rules as the register page; ensure the backend exposes `/api/query`, `/ingest/webhook`, and `/hello`.
- Accepts PDF/DOC/DOCX/TXT/images through the file picker; MIME type is forwarded to the backend.

## Known gaps / next steps
- Add auth headers once login is implemented; today requests are unauthenticated.
- Replace placeholder glyphs/icons and expose backend status visibly instead of the hidden test button.
- Handle long-running uploads/queries with loading indicators and retries.

## Backend touchpoints
- Query flow maps to `backend/app/api/router_query.py`.
- Upload flow maps to `backend/app/api/router_ingest.py`.
